% ---------------------- %
% -- IMPORTS REQUIRED -- %
% ---------------------- %

% A
\RequirePackage{amssymb}
% C
\RequirePackage{commado}
% E
\RequirePackage{esvect}
\PassOptionsToPackage{f}{esvect}
\RequirePackage{etoolbox}
% I
\RequirePackage{ifmtarg}
% M
\RequirePackage{mathtools}
% N
\RequirePackage{nicematrix}
% T
\RequirePackage{tikz}
\RequirePackage{tnscom}
\RequirePackage{trimspaces}
% X
\RequirePackage{xstring}
% Y
\RequirePackage{yhmath}

% TikZ libraries
\usetikzlibrary{babel}
\usetikzlibrary{calc}


% ------------------ %
% -- POINT N LINE -- %
% ------------------ %

% Points

\newcommand\pt{\@ifstar{\tnsgeo@pt@star}{\tnsgeo@pt@no@star}}

\newcommand\tnsgeo@pt@no@star[1]{\mathrm{#1}}

\newcommand\tnsgeo@pt@star[2]{%
    \tnsgeo@pt@no@star{#1}_{#2}
}


% Lines

\newcommand\gline[3][O]{%
    \IfStrEqCase{#1}{%
        {O}{%
        	\def\leftdelim {\left(}%
        	\def\rightdelim{\right)}%
	    }%
        {C}{%
        	\def\leftdelim {\left[}%
        	\def\rightdelim{\right]}%
	    }%
        {OC}{%
        	\def\leftdelim {\left(}%
        	\def\rightdelim{\right]}%
	    }%
        {CO}{%
        	\def\leftdelim {\left[}%
        	\def\rightdelim{\right)}%
	    }%
	}[%
        \PackageError{tnsgeo}{unknown option}%
                             {you can use O (default) C, OC or CO.}%
	]
    \leftdelim{} #2 #3 \rightdelim{}%
}

\newcommand\pgline[3][O]{%
    \gline[#1]{\pt{#2}}{\pt{#3}}%
}


\newcommand\hgline[2]{%
    \gline[CO]{#1}{#2}%
}

\newcommand\phgline[2]{%
    \pgline[CO]{#1}{#2}%
}


\newcommand\segment[2]{%
    \gline[C]{#1}{#2}%
}

\newcommand\psegment[2]{%
    \pgline[C]{#1}{#2}%
}


% Source
%    * https://tex.stackexchange.com/questions/511495
\let\stdparallel\parallel
\renewcommand{\parallel}{\mathrel{/\mkern-5mu/}}

\let\stdnparallel\nparallel
\renewcommand{\nparallel}{%
  \mathrel{\mathpalette\tnsgeo@not@parallel\relax}%
}
\newcommand{\tnsgeo@not@parallel}[2]{%
  \ooalign{\reflectbox{$\m@th#1\smallsetminus$}\cr\hfil$\m@th#1\parallel$\cr}%
}


% ------------ %
% -- VECTOR -- %
% ------------ %

\newcommand\tnsgeo@no@point[1]{%
    \if#1i%
        \imath%
    \else%
        \if#1j%
            \jmath%
        \else%
            #1
        \fi%
    \fi%
}

\newcommand\vect{\@ifstar{\tnsgeo@vect@star}{\tnsgeo@vect@no@star}}
\newcommand*\tnsgeo@vect@star[1]{\vv*{\tnsgeo@no@point{#1}}}
\newcommand*\tnsgeo@vect@no@star[1]{\vv{\tnsgeo@no@point{#1}}}


% ----------------- %
% -- VECTOR NORM -- %
% ----------------- %

% Source :
%    * https://tex.stackexchange.com/a/43009/6880
%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%

\let\tnsgeo@old@norm\norm

\renewcommand\norm[2][b]{%
    \IfEqCase{#1}{%
        {b}{\tnsgeo@old@norm*{#2}}%
        {s}{\tnsgeo@old@norm{#2}}%
    }[%
        \PackageError{tnsgeo}{unknown option}%
                             {you can use b (default) or s.}%
    ]
}

\newcommand\vnorm[2][b]{%
    \norm[#1]{\vect{#2}}%
}


% --------------------- %
% -- VECTOR PRODUCTS -- %
% --------------------- %

% DOT PRODUCT

%    #1 : 1st delimiter
%    #2 : 1st vector
%    #3 : inner separator
%    #4 : 2nd vector
%    #5 : 2nd delimiter

\newcommand\tnsgeo@dotprod@abstract@rafter[5]{%
    #1#2#3#4#5%
}


\newcommand\dotprod[3][u]{%
    \IfEqCase{#1}{%
% Usual
        {u}{%
            #2 \cdot #3%
        }%
% Bullet
        {b}{%
            #2 \mathbin{\text{\raisebox{.05em}{$\mathsmaller\symvar$}}} #3%
        }%
% Big parenthesis
        {p}{%
            \tnsgeo@dotprod@abstract@rafter{\left(\,}%
                                           {#2}
                                           {\,\left|\,\vphantom{#2}}%
                                           {#3}%
                                           {\right.\,\right)}%
        }%
% Small parenthesis
        {sp}{%
            \tnsgeo@dotprod@abstract@rafter{(\,}%
                                           {#2}%
                                           {\mid}%
                                           {#3}%
                                           {\,)}%
        }%
% Big raft
        {r}{%
            \tnsgeo@dotprod@abstract@rafter{\left\langle\,}%
                                           {#2}
                                           {\,\left|\,\vphantom{#2}}%
                                           {#3}%
                                           {\right.\,\right\rangle}%
        }%
% Small raft
        {sr}{%
            \tnsgeo@dotprod@abstract@rafter{\langle\,}%
                                           {#2}%
                                           {\mid}%
                                           {#3}%
                                           {\,\rangle}%
        }%
    }[%
        \PackageError{tnsgeo}{unknown option}%
                             {You can use u (default), p , sp , r or sr.}%
    ]%
}



\newcommand\vdotprod[3][u]{%
    \dotprod[#1]{\vect{#2}}{\vect{#3}}%
}


% The dot product - TO KEEP !!!!!!!

%    #1 : 1st vector
%    #2 : 2nd vector
%    #3 : operator for the products

%\newcommand\tnsgeo@dotprod@abstract@exp[3]{%
%    x_{#1} #3 x_{#2} + y_{#1} #3 y_{#2}%
%}




% CROSS PRODUCT

%    #1 : option for the operator
%    #2 : 1st vector
%    #3 : 2nd vector
\newcommand\crossprod[3][w]{%
    #2 %
    \IfEqCase{#1}{%
        {w}{\wedge}
        {t}{\times}
    }[%
        \PackageError{tnsgeo}{unknown option}%
                             {You can use w (default) or t.}%
    ]%
    #3
}

%    #1 : option for the operator
%    #2 : 1st vector
%    #3 : 2nd vector
\newcommand\vcrossprod[3][w]{%
    \crossprod[#1]{\vect{#2}}{\vect{#3}}%
}



% Stupid coordinates of the cross product

\newbool{tnsgeo@crossprod@option@p}   % Default.
\newbool{tnsgeo@crossprod@option@sp}
\newbool{tnsgeo@crossprod@option@vp}

\newbool{tnsgeo@crossprod@option@b}
\newbool{tnsgeo@crossprod@option@sb}
\newbool{tnsgeo@crossprod@option@vb}

\newbool{tnsgeo@crossprod@option@space}   % Default.
\newbool{tnsgeo@crossprod@option@times}
\newbool{tnsgeo@crossprod@option@cdot}


% Coordinates given like that.
%
%    #1    #4
%    #2    #5
%    #3    #6
%
% #7 : symbol for the product.
%
% #8 : one of the macro \coord, \vcoord or \vcoord*.
%
% #9 : one of the the option p, sp, vp, b, sb or vb. 
\newcommand\tnsgeo@apply@coord@crossprod[9]{%
    #8[#9]{%
    	\tns@prop@prod{#7}{#2}{#5}%
	                      {#3}{#6}
      | \tns@prop@prod{#7}{#3}{#6}%
	                      {#1}{#4}
      | \tns@prop@prod{#7}{#1}{#4}%
	                      {#2}{#5}
    }%
}


\newcommand\tnsgeo@validate@crossprod@option[1]{
    \IfEqCase{#1}{%
        {p}{\booltrue{tnsgeo@crossprod@option@p}}%
        {sp}{\booltrue{tnsgeo@crossprod@option@sp}}
        {vp}{\booltrue{tnsgeo@crossprod@option@vp}}
        %
        {b}{\booltrue{tnsgeo@crossprod@option@b}}
        {sb}{\booltrue{tnsgeo@crossprod@option@sb}}
        {vb}{\booltrue{tnsgeo@crossprod@option@vb}}
        %
        {s}{\booltrue{tnsgeo@crossprod@option@space}}%
        {t}{\booltrue{tnsgeo@crossprod@option@times}}
        {c}{\booltrue{tnsgeo@crossprod@option@cdot}}
    }[%
        \PackageError{tnsgeo}{unknown option}%
                             {You can use p, sp, vp, b, sb, vb, s, t or c.}%
    ]
}


\newcommand\coordcrossprod[7][p,s]{%
    \boolfalse{tnsgeo@crossprod@option@p}
    \boolfalse{tnsgeo@crossprod@option@sp}
    \boolfalse{tnsgeo@crossprod@option@vp}
    \boolfalse{tnsgeo@crossprod@option@b}
    \boolfalse{tnsgeo@crossprod@option@sb}
    \boolfalse{tnsgeo@crossprod@option@vb}
    \boolfalse{tnsgeo@crossprod@option@space}
    \boolfalse{tnsgeo@crossprod@option@times}
    \boolfalse{tnsgeo@crossprod@option@cdot}
    %
    \def\@coord@option{NOTHING}%
    \def\@exp@symbol{NOTHING}%
    %
    \DoWithCSL\tnsgeo@validate@crossprod@option{#1}
    %
    \ifbool{tnsgeo@crossprod@option@p}{%
        \def\@coord@option{p}%
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@sp}{%
        \def\@coord@option{sp}%
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@vp}{%
        \def\@coord@option{vp}%
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@b}{%
        \def\@coord@option{b}%
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@sb}{%
        \def\@coord@option{sb}%
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@vb}{%
        \def\@coord@option{vb}%
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@space}{%
        \def\@exp@symbol{\,}%    
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@times}{%
        \def\@exp@symbol{\times}%    
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@cdot}{%
        \def\@exp@symbol{\cdot}%    
    }{}%
    %
    \ifbool{tnsgeo@crossprod@option@sp}{}{%
        \ifbool{tnsgeo@crossprod@option@vp}{}{%
            \ifbool{tnsgeo@crossprod@option@b}{}{%
                \ifbool{tnsgeo@crossprod@option@sb}{}{%
                    \ifbool{tnsgeo@crossprod@option@vb}{}{%
                        \def\@coord@option{p}% Default
                    }%
                }%
            }%
        }%
    }%
    %
    \ifbool{tnsgeo@crossprod@option@times}{}{%
        \ifbool{tnsgeo@crossprod@option@cdot}{}{%
            \def\@exp@symbol{\,}% Default
        }%
    }%
    %
    \tnsgeo@apply@coord@crossprod{#2}{#3}{#4}% Vector 1
                                 {#5}{#6}{#7}% Vector 2
                                 {\@exp@symbol}%
                                 {\coord}{\@coord@option}%
}


% Abstraction

% Source
%    * https://tex.stackexchange.com/a/548662/6880

\newcommand\tnsgeo@calc@crossprod@label[1]{%
    {\tiny$\substack{-\\#1}$}%
}


\newcommand\calccrossprod{\@ifstar{\tnsgeo@calc@crossprod@star}{\tnsgeo@calc@crossprod@no@star}}


\newcommand\tnsgeo@calc@crossprod@star[9][vec]{%
    \tns@det@plane@open{#1}{&}{#2}{#6}%
        \tns@det@plane@entries{&}{#3}{#4}{#7}{#8} \\
        %
        #5                & #9                    \\
        {\color{blue} #3} & {\color{blue} #7}
    \end{vNiceMatrix}
}

% Source: https://tex.stackexchange.com/a/554468/6880
\newcommand\tnsgeo@calc@crossprod@no@star[9][vec]{%
    \makeatletter% Babel TikZ library doesn't help me here but it does in other places.
        \tnsgeo@calc@crossprod@no@star@aux{#1}{#2}{#3}{#4}{#5}{#6}{#7}{#8}{#9}%
    \makeatother%
}

\newcommand\tnsgeo@calc@crossprod@no@star@aux[9]{%
    \tns@det@plane@open{#1}{&&}{#2}{#6}%
        \tns@det@plane@entries{&&}{#3}{#4}{#7}{#8} \\
        %
        #5                && #9                    \\
        {\color{blue} #3} && {\color{blue} #7}
        %%
        \CodeAfter
        \begin{tikzpicture}
            \path (2-1.east) 
                  -- node[below = 0.3em,
                          blue,
                          circle,
                          inner sep = .4pt]
                     (minusone) {\tnsgeo@calc@crossprod@label{1}}
                  (2-3.west);
            \draw [blue,->]
                  let \p1 = ($(minusone.east) - (minusone.center)$) in 
                      ([xshift = 0.5mm,yshift=-0.05mm]2-1.east)
                      to[out = 0, in = 137.5]
                      ([yshift=-0.05mm]minusone.50)
                      arc[start angle = 50,
                          end angle = -230,
                          radius = \x1] 
                      to[out = 42.5, in =190]
                      ([xshift = -0.3mm,yshift=-0.05mm]2-1.east-|2-3.west);
            %%
            \path (3-1.east) 
                  -- node[below = 0.3em,
                          red,
                          circle,
                          inner sep = .4pt] 
                     (minustwo) {\tnsgeo@calc@crossprod@label{2}}
                  (3-3.west);
            \draw [red,->]
                  let \p1 = ($(minustwo.east) - (minustwo.center)$) in 
                      ([xshift=0.5mm,yshift=-0.6mm]3-1.east)
                      to[out = 0, in = 137.5]
                      ([yshift=-0.6mm]minustwo.50)
                      arc[start angle = 50,
                          end angle = -230,
                          radius = \x1] 
                      to[out = 42.5, in =190] 
                      ([xshift = -0.3mm,yshift=-0.6mm]3-1.east-|3-3.west);
            %%
            \path (1-1.east) 
                  -- node[below = 0.3em,
                          orange,
                          circle,
                          inner sep = .4pt] 
                     (minus) {\tnsgeo@calc@crossprod@label{3}}
                  (1-3.west);
            \draw [orange,->]
                  let \p1 = ($(minus.east) - (minus.center)$) in 
                      ([xshift=0.5mm]1-1.east)
                      to[out = 0, in = 137.5]
                      (minus.50)
                      arc[start angle = 50,
                          end angle = -230,
                          radius = \x1] 
                      to[out = 42.5, in =190] 
                      ([xshift=-0.3mm]1-1.east-|1-3.west);
        \end{tikzpicture} 
    \end{vNiceMatrix}
}


\newcommand\vcalccrossprod{\@ifstar{\tnsgeo@vcalc@crossprod@star}{\tnsgeo@vcalc@crossprod@no@star}}

\newcommand\tnsgeo@vcalc@crossprod@no@star[9][vec]{%
    \calccrossprod[#1]{\vect{#2}}{#3}{#4}{#5}%
                      {\vect{#6}}{#7}{#8}{#9}%
}

\newcommand\tnsgeo@vcalc@crossprod@star[9][vec]{%
    \calccrossprod*[#1]{\vect{#2}}{#3}{#4}{#5}
                       {\vect{#6}}{#7}{#8}{#9}%
}


% --------------------------- %
% -- VECTOR 2D COLINEARITY -- %
% --------------------------- %

%   #1 : option for the formatting
%
%   #2  #5		u  v
%   
%   #3  #6		x  x'
%   #4  #7      y  y'

\newcommand\calcdetplane{\@ifstar{\tnsgeo@calc@detplane@star}{\tnsgeo@calc@detplane@no@star}}


%   #1 : option for the formatting
%
%   #2  #5		u  v
%   
%   #3  #6		x  x'
%   #4  #7      y  y'

\newcommand\tnsgeo@calc@detplane@no@star[7][vec]{%
    \IfEqCase{#1}{%
% WARNING !
%   
%   #1 : symbol for the product
%
%   #2  #3		x  x'
%   #4  #5      y  y'
        {exp}{%
            \tns@prop@prod{\,}%
                          {#3}{#4}%
                          {#6}{#7}%
        }{cexp}{%
            \tns@prop@prod{\cdot}%
                          {#3}{#4}%
                          {#6}{#7}%
        }{texp}{%
            \tns@prop@prod{\times}%
                          {#3}{#4}%
                          {#6}{#7}%
        }{vec}{%
            \tns@det@plane@deco{#1}%
                               {#2}{#3}{#4}%
                               {#5}{#6}{#7}%
        }{novec}{%
            \tns@det@plane@deco{#1}%
                               {#2}{#3}{#4}%
                               {#5}{#6}{#7}%
        }%
    }[
    	\PackageError{tnsgeo}{unknown option}%
                             {You can use vec (default), novec, exp, cexp or texp.}
    ]%
}


%   #1 : option for the formatting
%
%   #2  #5		u  v
%   
%   #3  #6		x  x'
%   #4  #7      y  y'

\newcommand\tnsgeo@calc@detplane@star[7][vec]{%
% WARNING !
%   
%   #1 : symbol for the product
%
%   #2  #3		x  x'
%   #4  #5      y  y'
    \IfEqCase{#1}{%
        {exp}{%
            \tns@prop@prod{\,}%
                          {#3}{#6}%
                          {#4}{#7}%
        }{cexp}{%
            \tns@prop@prod{\cdot}%
                          {#3}{#6}%
                          {#4}{#7}%
        }{texp}{%
            \tns@prop@prod{\times}%
                          {#3}{#6}%
                          {#4}{#7}%
        }{vec}{%
            \tns@det@plane@no@deco{#1}%
                                  {#2}{#3}{#4}%
                                  {#5}{#6}{#7}%
        }{novec}{%
            \tns@det@plane@no@deco{#1}%
                                  {#2}{#3}{#4}%
                                  {#5}{#6}{#7}%
        }%
    }[
    	\PackageError{tnsgeo}{unknown option}%
                             {You can use vec (default), novec, exp, cexp or texp.}
    ]%
}


\newcommand\vcalcdetplane{\@ifstar{\tnsgeo@vcalc@detplane@star}{\tnsgeo@vcalc@detplane@no@star}}


\newcommand\tnsgeo@vcalc@detplane@star[7][vec]{%
    \tnsgeo@calc@detplane@star[#1]{\vect{#2}}{#3}{#4}%
                                  {\vect{#5}}{#6}{#7}%
}


\newcommand\tnsgeo@vcalc@detplane@no@star[7][vec]{%
    \tnsgeo@calc@detplane@no@star[#1]{\vect{#2}}{#3}{#4}%
                                     {\vect{#5}}{#6}{#7}%
}


% --------------------------- %
% -- CARTESIAN COORDINATES -- %
% --------------------------- %

\newcommand\coord[2][p]{%
    \IfEqCase{#1}{%
        {p}{%
            \left( \,%
% ARG 1  = Separator: |
% ARG 2  = All parts: what the user types !
% ARG 3  = Before   : nothing here
% ARG 4  = Between  : ;
% ARG 5  = After    : nothing here
% OPTION = Ornament : macro to apply to each item
                 \tns@multi@args{|}{#2}{}{\tnsmathsep}{}%
             \, \right)%
        }{sp}{%
            (\tns@multi@args{|}{#2}{}{\tnsmathsep}{})%
        }{b}{%
            \left[ \,%
                 \tns@multi@args{|}{#2}{}{\tnsmathsep}{}%
             \, \right]%
        }{sb}{%
            [\tns@multi@args{|}{#2}{}{\tnsmathsep}{}]%
        }{vp}{%
            \tns@multi@args{|}{#2}{\begin{pmatrix}}{\\}{\end{pmatrix}}%
        }{vb}{%
            \tns@multi@args{|}{#2}{\begin{bNiceMatrix}}{\\}{\end{bNiceMatrix}}%
        }%
    }[
        \PackageError{ynsgeo}{unknown option}%
                             {You can use p (default), sp, b, sb, vp or vb.}
    ]%
}


\newcommand\tnsgeo@extra@coord[3][p]{%
    #2\coord[#1]{#3}%
}


\newcommand\pcoord{\@ifstar{\tnsgeo@extra@coord}{\tnsgeo@pcoord@no@star}}

\newcommand\tnsgeo@pcoord@no@star[3][p]{%
    \pt{#2}\coord[#1]{#3}%
}


\newcommand\vcoord{\@ifstar{\tnsgeo@extra@coord}{\tnsgeo@vcoord@no@star}}

\newcommand\tnsgeo@vcoord@no@star[3][p]{%
    \vect{#2}\coord[#1]{#3}%
}


% -------------------- %
% -- CARTESIAN AXES -- %
% -------------------- %

% Sources : see the sources of the macros for continued fractions.

% General naming of axes
\def\tnsgeo@axes@comafy@#1|#2\@nil{%
    \@ifmtarg{#2}{%
        #1%
    }{%
        #1 \tnsmathsubsep{} \tnsgeo@axes@comafy@#2\@nil%
    }%
}

\newcommand\axes{\@ifstar{\tnsgeo@axes@star}{\tnsgeo@axes@no@star}}

\newcommand\tnsgeo@axes@no@star[1]{%
    \tnsgeo@axes@no@star@splitter@#1|\@nil%
}
\def\tnsgeo@axes@no@star@splitter@#1|#2\@nil{%
    \ensuremath{\tns@generic@interval@ext{(}{#1}{\tnsmathsep{}}{\tnsgeo@axes@comafy@#2\@nil}{)}}%
}

\newcommand\tnsgeo@axes@star[1]{%
    \tnsgeo@axes@star@splitter@#1|\@nil%
}
\def\tnsgeo@axes@star@splitter@#1|#2\@nil{%
    \ensuremath{\tns@generic@interval@semi@ext{(}{#1}{\tnsmathsep{}}{\tnsgeo@axes@comafy@#2\@nil}{)}}%
}

% Geometric points for naming some axes
\def\tnsgeo@axes@comafy@gptify@#1|#2\@nil{%
    \@ifmtarg{#2}{%
        \pt{#1}%
    }{%
        \pt{#1} \tnsmathsubsep{} \tnsgeo@axes@comafy@gptify@#2\@nil%
    }%
}

\newcommand\paxes[1]{%
    \tnsgeo@paxes@splitter@#1|\@nil%
}
\def\tnsgeo@paxes@splitter@#1|#2\@nil{%
    \ensuremath{\tns@generic@interval@ext{(}{\pt{#1}}{\tnsmathsep{}}{\tnsgeo@axes@comafy@gptify@#2\@nil}{)}}%
}

% Vectors for naming some axes
\def\tnsgeo@axes@comafy@vectify@#1|#2\@nil{%
    \@ifmtarg{#2}{%
        \vect{\trim@spaces{#1}}%
    }{%
        \vect{\trim@spaces{#1}} \tnsmathsubsep{} \tnsgeo@axes@comafy@vectify@#2\@nil%
    }%
}

\newcommand\vaxes[1]{%
    \tnsgeo@vaxes@splitter@#1|\@nil%
}
\def\tnsgeo@vaxes@splitter@#1|#2\@nil{%
    \ensuremath{\tns@generic@interval@ext{(}{#1}{\tnsmathsep{}}{\tnsgeo@axes@comafy@vectify@#2\@nil}{)}}%
}

% Geometric points and vectors for naming some axes
\newcommand\pvaxes[1]{%
    \tnsgeo@pvaxes@splitter@#1|\@nil%
}
\def\tnsgeo@pvaxes@splitter@#1|#2\@nil{%
    \ensuremath{\tns@generic@interval@ext{(}{\pt{#1}}{\tnsmathsep{}}{\tnsgeo@axes@comafy@vectify@#2\@nil}{)}}%
}


% --------- %
% -- ARC -- %
% --------- %

\newcommand\circarc{\@ifstar{\tnsgeo@circ@arc@star}{\tnsgeo@circ@arc@no@star}}

\newcommand*\tnsgeo@circ@arc@star[2]{%
    \wideparen{\tnsgeo@no@point{#1}}\vphantom{#1}_{#2}%
}

\newcommand*\tnsgeo@circ@arc@no@star[1]{%
    \wideparen{\tnsgeo@no@point{#1}}%
}


% --------------------- %
% -- ANGLE GEOMETRIC -- %
% --------------------- %

% Source : http://forum.mathematex.net/latex-f6/arc-dont-le-nom-comporte-un-indice-t12392.html#p120204

\newcommand\anglein{\@ifstar{\tnsgeo@anglein@star}{\tnsgeo@anglein@no@star}}

\newcommand*\tnsgeo@anglein@star[2]{%
    \widehat{\tnsgeo@no@point{#1}}\vphantom{#1}_{#2}%
}

\newcommand*\tnsgeo@anglein@no@star[1]{%
    \widehat{\tnsgeo@no@point{#1}}%
}


% -------------------- %
% -- ANGLE ORIENTED -- %
% -------------------- %

\newcommand\angleorient[3][p]{%
    \IfEqCase{#1}{%
% Big parenthesis (no hat)
        {p}{%
            \tns@generic@interval@ext{(}{\, #2}{\tnsmathsep}{#3\, }{)}%
        }%
% Small parenthesis (no hat)
        {sp}{%
            \tns@generic@interval@semi@ext{(}{\, #2}{\tnsmathsep}{#3\, }{)}%
        }%
% Hat - Big parenthesis
        {h}{%
            \widehat{\angleorient{#2}{#3}}%
        }%
% Hat - Small parenthesis
        {sh}{%
            \widehat{\angleorient[sp]{#2}{#3}}%
        }%
    }[%
        \PackageError{tnsgeo}{unknown option}%
                             {You can use p (default), sp, h or sh.}%
    ]%
}


\newcommand\vangleorient[3][p]{%
    \angleorient[#1]{\vect{#2}}{\vect{#3}}%
}
